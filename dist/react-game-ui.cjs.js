"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react");function r(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const t in e)if("default"!==t){const n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:()=>e[t]})}return r.default=e,Object.freeze(r)}const t=r(e);var n,o={exports:{}},a={};var i,l,s={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function c(){return i||(i=1,"production"!==process.env.NODE_ENV&&function(){var r=e,t=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),g=Symbol.iterator;var h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function x(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];!function(e,r,t){var n=h.ReactDebugCurrentFrame.getStackAddendum();""!==n&&(r+="%s",t=t.concat([n]));var o=t.map(function(e){return String(e)});o.unshift("Warning: "+r),Function.prototype.apply.call(console[e],console,o)}("error",e,t)}var b;function k(e){return e.displayName||"Context"}function v(e){if(null==e)return null;if("number"==typeof e.tag&&x("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case o:return"Fragment";case n:return"Portal";case i:return"Profiler";case a:return"StrictMode";case p:return"Suspense";case u:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case c:return k(e)+".Consumer";case l:return k(e._context)+".Provider";case d:return function(e,r,t){var n=e.displayName;if(n)return n;var o=r.displayName||r.name||"";return""!==o?t+"("+o+")":t}(e,e.render,"ForwardRef");case f:var r=e.displayName||null;return null!==r?r:v(e.type)||"Memo";case y:var t=e,s=t._payload,m=t._init;try{return v(m(s))}catch(g){return null}}return null}b=Symbol.for("react.module.reference");var j,C,S,w,_,I,$,P=Object.assign,O=0;function D(){}D.__reactDisabledLog=!0;var R,T=h.ReactCurrentDispatcher;function E(e,r,t){if(void 0===R)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);R=n&&n[1]||""}return"\n"+R+e}var F,N=!1,B="function"==typeof WeakMap?WeakMap:Map;function W(e,r){if(!e||N)return"";var t,n=F.get(e);if(void 0!==n)return n;N=!0;var o,a=Error.prepareStackTrace;Error.prepareStackTrace=void 0,o=T.current,T.current=null,function(){if(0===O){j=console.log,C=console.info,S=console.warn,w=console.error,_=console.group,I=console.groupCollapsed,$=console.groupEnd;var e={configurable:!0,enumerable:!0,value:D,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}O++}();try{if(r){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(i,[])}catch(y){t=y}Reflect.construct(e,[],i)}else{try{i.call()}catch(y){t=y}e.call(i.prototype)}}else{try{throw Error()}catch(y){t=y}e()}}catch(m){if(m&&t&&"string"==typeof m.stack){for(var l=m.stack.split("\n"),s=t.stack.split("\n"),c=l.length-1,d=s.length-1;c>=1&&d>=0&&l[c]!==s[d];)d--;for(;c>=1&&d>=0;c--,d--)if(l[c]!==s[d]){if(1!==c||1!==d)do{if(c--,--d<0||l[c]!==s[d]){var p="\n"+l[c].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),"function"==typeof e&&F.set(e,p),p}}while(c>=1&&d>=0);break}}}finally{N=!1,T.current=o,function(){if(0===--O){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:P({},e,{value:j}),info:P({},e,{value:C}),warn:P({},e,{value:S}),error:P({},e,{value:w}),group:P({},e,{value:_}),groupCollapsed:P({},e,{value:I}),groupEnd:P({},e,{value:$})})}O<0&&x("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=a}var u=e?e.displayName||e.name:"",f=u?E(u):"";return"function"==typeof e&&F.set(e,f),f}function z(e,r,t){if(null==e)return"";if("function"==typeof e)return W(e,!(!(n=e.prototype)||!n.isReactComponent));var n;if("string"==typeof e)return E(e);switch(e){case p:return E("Suspense");case u:return E("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case d:return W(e.render,!1);case f:return z(e.type,r,t);case y:var o=e,a=o._payload,i=o._init;try{return z(i(a),r,t)}catch(l){}}return""}F=new B;var M=Object.prototype.hasOwnProperty,U={},A=h.ReactDebugCurrentFrame;function L(e){if(e){var r=e._owner,t=z(e.type,e._source,r?r.type:null);A.setExtraStackFrame(t)}else A.setExtraStackFrame(null)}var V=Array.isArray;function Y(e){return V(e)}function q(e){return""+e}function H(e){if(function(e){try{return q(e),!1}catch(r){return!0}}(e))return x("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),q(e)}var J,K,X=h.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};function Q(e,r,n,o,a){var i,l={},s=null,c=null;for(i in void 0!==n&&(H(n),s=""+n),function(e){if(M.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return void 0!==e.key}(r)&&(H(r.key),s=""+r.key),function(e){if(M.call(e,"ref")){var r=Object.getOwnPropertyDescriptor(e,"ref").get;if(r&&r.isReactWarning)return!1}return void 0!==e.ref}(r)&&(c=r.ref,function(e){"string"==typeof e.ref&&X.current}(r)),r)M.call(r,i)&&!G.hasOwnProperty(i)&&(l[i]=r[i]);if(e&&e.defaultProps){var d=e.defaultProps;for(i in d)void 0===l[i]&&(l[i]=d[i])}if(s||c){var p="function"==typeof e?e.displayName||e.name||"Unknown":e;s&&function(e,r){var t=function(){J||(J=!0,x("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(l,p),c&&function(e,r){var t=function(){K||(K=!0,x("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};t.isReactWarning=!0,Object.defineProperty(e,"ref",{get:t,configurable:!0})}(l,p)}return function(e,r,n,o,a,i,l){var s={$$typeof:t,type:e,key:r,ref:n,props:l,_owner:i,_store:{}};return Object.defineProperty(s._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(s,"_self",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.defineProperty(s,"_source",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.freeze&&(Object.freeze(s.props),Object.freeze(s)),s}(e,s,c,a,o,X.current,l)}var Z,ee=h.ReactCurrentOwner,re=h.ReactDebugCurrentFrame;function te(e){if(e){var r=e._owner,t=z(e.type,e._source,r?r.type:null);re.setExtraStackFrame(t)}else re.setExtraStackFrame(null)}function ne(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}function oe(){if(ee.current){var e=v(ee.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}Z=!1;var ae={};function ie(e,r){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var t=function(e){var r=oe();if(!r){var t="string"==typeof e?e:e.displayName||e.name;t&&(r="\n\nCheck the top-level render call using <"+t+">.")}return r}(r);if(!ae[t]){ae[t]=!0;var n="";e&&e._owner&&e._owner!==ee.current&&(n=" It was passed a child from "+v(e._owner.type)+"."),te(e),x('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',t,n),te(null)}}}function le(e,r){if("object"==typeof e)if(Y(e))for(var t=0;t<e.length;t++){var n=e[t];ne(n)&&ie(n,r)}else if(ne(e))e._store&&(e._store.validated=!0);else if(e){var o=function(e){if(null===e||"object"!=typeof e)return null;var r=g&&e[g]||e["@@iterator"];return"function"==typeof r?r:null}(e);if("function"==typeof o&&o!==e.entries)for(var a,i=o.call(e);!(a=i.next()).done;)ne(a.value)&&ie(a.value,r)}}function se(e){var r,t=e.type;if(null!=t&&"string"!=typeof t){if("function"==typeof t)r=t.propTypes;else{if("object"!=typeof t||t.$$typeof!==d&&t.$$typeof!==f)return;r=t.propTypes}if(r){var n=v(t);!function(e,r,t,n,o){var a=Function.call.bind(M);for(var i in e)if(a(e,i)){var l=void 0;try{if("function"!=typeof e[i]){var s=Error((n||"React class")+": "+t+" type `"+i+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[i]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw s.name="Invariant Violation",s}l=e[i](r,i,n,t,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(c){l=c}!l||l instanceof Error||(L(o),x("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",n||"React class",t,i,typeof l),L(null)),l instanceof Error&&!(l.message in U)&&(U[l.message]=!0,L(o),x("Failed %s type: %s",t,l.message),L(null))}}(r,e.props,"prop",n,e)}else if(void 0!==t.PropTypes&&!Z){Z=!0,x("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",v(t)||"Unknown")}"function"!=typeof t.getDefaultProps||t.getDefaultProps.isReactClassApproved||x("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}var ce={};function de(e,r,n,s,g,h){var k=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===i||e===a||e===p||e===u||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===f||e.$$typeof===l||e.$$typeof===c||e.$$typeof===d||e.$$typeof===b||void 0!==e.getModuleId)}(e);if(!k){var j="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(j+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var C;j+=oe(),null===e?C="null":Y(e)?C="array":void 0!==e&&e.$$typeof===t?(C="<"+(v(e.type)||"Unknown")+" />",j=" Did you accidentally export a JSX literal instead of a component?"):C=typeof e,x("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",C,j)}var S=Q(e,r,n,g,h);if(null==S)return S;if(k){var w=r.children;if(void 0!==w)if(s)if(Y(w)){for(var _=0;_<w.length;_++)le(w[_],e);Object.freeze&&Object.freeze(w)}else x("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else le(w,e)}if(M.call(r,"key")){var I=v(e),$=Object.keys(r).filter(function(e){return"key"!==e}),P=$.length>0?"{key: someKey, "+$.join(": ..., ")+": ...}":"{key: someKey}";if(!ce[I+P])x('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',P,I,$.length>0?"{"+$.join(": ..., ")+": ...}":"{}",I),ce[I+P]=!0}return e===o?function(e){for(var r=Object.keys(e.props),t=0;t<r.length;t++){var n=r[t];if("children"!==n&&"key"!==n){te(e),x("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",n),te(null);break}}null!==e.ref&&(te(e),x("Invalid attribute `ref` supplied to `React.Fragment`."),te(null))}(S):se(S),S}var pe=function(e,r,t){return de(e,r,t,!1)},ue=function(e,r,t){return de(e,r,t,!0)};s.Fragment=o,s.jsx=pe,s.jsxs=ue}()),s}var d=(l||(l=1,"production"===process.env.NODE_ENV?o.exports=function(){if(n)return a;n=1;var r=e,t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,r,n){var o,a={},c=null,d=null;for(o in void 0!==n&&(c=""+n),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)i.call(r,o)&&!s.hasOwnProperty(o)&&(a[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===a[o]&&(a[o]=r[o]);return{$$typeof:t,type:e,key:c,ref:d,props:a,_owner:l.current}}return a.Fragment=o,a.jsx=c,a.jsxs=c,a}():o.exports=c()),o.exports);const p="_boardContainer_1laip_8",u="_cell_1laip_28";function f({row:e,col:r,cellData:t,onClick:n,onDoubleClick:o,children:a,onDrop:i,onDragOver:l,changed:s=!1}){const c={backgroundColor:s?t.changedColor:t.backgroundColor};return d.jsx("div",{className:u,onClick:()=>{n(e,r)},onDoubleClick:()=>{o(e,r)},onDrop:i,onDragOver:l,style:c,children:a})}const y={piece:"_piece_wi08l_3"};function m({piece:e,style:r,onClick:t,isDraggable:n,onDragStart:o}){const a=[y.piece,n?y.draggable:y.clickable].join(" ");return d.jsx("div",{className:a,style:{...r,backgroundColor:e.color},onClick:r=>{r.stopPropagation(),t(e.id)},draggable:n,onDragStart:r=>{n&&(r.stopPropagation(),r.dataTransfer.setData("text/plain",e.id),r.dataTransfer.effectAllowed="move",o(r,e))},title:e.name,children:e.name.substring(0,1)})}const g={card:"_card_1mv54_3",tooltip:"_tooltip_1mv54_23",cardBack:"_cardBack_1mv54_47",deckContainer:"_deckContainer_1mv54_59",deckCard:"_deckCard_1mv54_66",deckCardFront:"_deckCardFront_1mv54_78",deckSection:"_deckSection_1mv54_95",discardPileWrapper:"_discardPileWrapper_1mv54_103",discardTopCard:"_discardTopCard_1mv54_109"},h=({card:e})=>e.isFaceUp?e.frontImage?d.jsx("img",{src:e.frontImage,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain"}}):(console.log(`[CardContent] pngの描画失敗" ${e.id}. Path: ${e.frontImage}`),d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"5px"},children:d.jsx("strong",{style:{fontSize:"1em",wordBreak:"break-all",textAlign:"center"},children:e.name})})):null;function x(e,...r){console.log(`[${e}]`,...r)}const b=({card:e,isFaceUp:r})=>r?e.frontImage?d.jsx("img",{src:e.frontImage,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain"}}):d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"5px",color:"#333"},children:d.jsx("strong",{style:{fontSize:"0.8em",wordBreak:"break-all",textAlign:"center"},children:e.name})}):null;const k=t.memo(({card:e,isFaceUp:r})=>r?e.frontImage?d.jsx("img",{src:e.frontImage,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain"}}):d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"5px",color:"#333"},children:d.jsx("strong",{style:{fontSize:"0.8em",wordBreak:"break-all",textAlign:"center"},children:e.name})}):null),v=t.memo(({tokens:e,socket:r,myPlayerId:t,playerIdBeingDisplayed:n})=>{const o=t===n;return e&&0!==e.length?d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #ddd"},children:e.map(e=>d.jsx("div",{title:`クリックして再獲得: ${e.name}`,style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffffff",borderRadius:"50%",width:"48px",height:"48px",fontSize:"0.75em",fontWeight:"bold",textAlign:"center",lineHeight:"1.1",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",cursor:o?"pointer":"default",opacity:o?1:.7,flexShrink:0,wordBreak:"break-word",padding:"2px"},children:e.name},e.id))}):null}),j=t.memo(({player:e,currentPlayerId:r,myPlayerId:t,selectedCards:n,toggleCardSelection:o,socket:a})=>d.jsxs("li",{style:{padding:"6px 12px",marginBottom:"6px",borderRadius:"4px",backgroundColor:e.id===r?"#a0e7ff":"#f5f5f5",fontWeight:e.id===r?"bold":"normal"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontSize:"1.1em",color:"#333"},children:[e.id===r&&"ᐅ ",e.id===t&&"★ ME ",e.name]}),d.jsxs("span",{style:{fontSize:"1.2em"},children:["スコア: ",e.score]})]}),e.resources&&e.resources.length>0&&d.jsxs("div",{style:{display:"block",marginTop:"4px",marginBottom:"8px",fontSize:"0.9em",color:"#333"},children:[d.jsx("strong",{style:{display:"block",marginBottom:"4px"},children:"リソース:"}),d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:e.resources.map(e=>d.jsxs("span",{title:e.name,style:{padding:"4px 8px",backgroundColor:"#f0f0f0",borderRadius:"4px",whiteSpace:"nowrap"},children:[e.icon," ",e.name,": ",e.currentValue," / ",e.maxValue]},e.id))})]}),e.tokens&&e.tokens.length>0&&d.jsx(v,{tokens:e.tokens,socket:a,myPlayerId:t,playerIdBeingDisplayed:e.id}),d.jsx("div",{style:{display:"flex",gap:"6px",marginTop:"6px",flexWrap:"wrap"},children:e.cards.map(r=>{const a=!!r.isFaceUp&&e.id===t,i=n.includes(r.id);return d.jsxs("div",{className:a?g.card:g.cardBack,style:{position:"relative",cursor:a?"pointer":"default",backgroundColor:a?void 0:r.backColor,border:i?"2px solid gold":"none",boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>o(r.id,a),children:[d.jsx(k,{card:r,isFaceUp:a}),a&&r.description&&d.jsx("span",{className:g.tooltip,children:r.description})]},r.id)})})]},e.id),(e,r)=>e.player===r.player&&e.selectedCards===r.selectedCards&&e.myPlayerId===r.myPlayerId&&e.currentPlayerId===r.currentPlayerId);const C=e.memo(({token:e})=>e.imageSrc?d.jsx("img",{src:e.imageSrc,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain"}}):d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"5px"},children:d.jsx("strong",{style:{fontSize:"1em",wordBreak:"break-all",textAlign:"center"},children:e.name})}));exports.Board=function({rows:e,cols:r,boardData:t,pieces:n,changedCells:o,renderCell:a,onCellClick:i,onCellDoubleClick:l,onPieceClick:s,allowPieceDrag:c=!1,onPieceDragStart:u,onCellDrop:y}){const g={"--board-rows":e,"--board-cols":r,display:"grid",gridTemplateRows:`repeat(${e}, 1fr)`,gridTemplateColumns:`repeat(${r}, 1fr)`,gap:"4px",width:"600px",height:"600px",position:"relative"};return d.jsxs("div",{className:p,style:g,children:[t.map((e,r)=>e.map((e,n)=>{const s=o.some(e=>e.row===r&&e.col===n),c=s?e.changedContent:e.content,p={...e,content:c};return d.jsx(f,{row:r,col:n,cellData:p,onClick:()=>((e,r)=>{const n=t[e][r];i(n,e,r)})(r,n),onDoubleClick:()=>((e,r)=>{const n=t[e][r];l(n,e,r)})(r,n),onDrop:e=>y(e,r,n),onDragOver:e=>e.preventDefault(),changed:s,children:a(p,r,n)},e.id)})),n.map(e=>{const r=n.filter(r=>r.location.row===e.location.row&&r.location.col===e.location.col),t=r.findIndex(r=>r.id===e.id),o=r.length;let a=0,i=0;if(o>1){const e=18,r=2*Math.PI/o*t;a=e*Math.cos(r),i=e*Math.sin(r)}const l={gridArea:`${e.location.row+1} / ${e.location.col+1} / span 1 / span 1`,alignSelf:"center",justifySelf:"center",transform:`translate(${a}px, ${i}px)`,transition:"transform 0.3s ease-in-out"};return d.jsx(m,{piece:e,style:l,onClick:s,isDraggable:c,onDragStart:r=>((e,r)=>{u(e,r)})(r,e)},e.id)})]})},exports.Deck=function({socket:e,deckId:r,name:n,playerId:o=null}){const[a,i]=t.useState([]),[l,s]=t.useState([]),[c,p]=t.useState([]),[u,f]=t.useState(!1);return t.useEffect(()=>(e.on(`deck:init:${r}`,e=>{i(e.currentDeck.map(e=>({...e,deckId:r}))),s(e.drawnCards.map(e=>({...e,deckId:r}))),p(e.discardPile.map(e=>({...e,deckId:r})))}),e.on(`deck:update:${r}`,e=>{console.log("drawnCards:",e.drawnCards),console.log("[Deck Update] discardPile:",e.discardPile),i(e.currentDeck.map(e=>({...e,deckId:r}))),s(e.drawnCards.map(e=>({...e,deckId:r}))),p(e.discardPile.map(e=>({...e,deckId:r})))}),()=>{e.off(`deck:init:${r}`),e.off(`deck:update:${r}`)}),[e,r]),d.jsxs("section",{className:g.deckSection,children:[d.jsx("h3",{style:{marginBottom:"6px"},children:n}),d.jsxs("div",{className:g.deckControls,children:[d.jsx("button",{onClick:()=>e.emit("deck:shuffle",{deckId:r}),children:"シャッフル"}),d.jsx("button",{onClick:()=>e.emit("deck:reset",{deckId:r}),children:"山札に戻す"})]}),d.jsxs("div",{className:g.deckWrapper,style:{display:"flex",gap:"0px"},children:[d.jsx("div",{className:g.deckContainer,onClick:()=>{if(0===a.length)return;const t=a[0],n=t?.drawLocation||"hand",i={deckId:r,drawLocation:n};"hand"===n&&o&&(i.playerId=o),e.emit("deck:draw",i)},children:a.map((e,r)=>d.jsx("div",{className:g.deckCard,style:{zIndex:a.length-r,transform:`translate(${.3*r}px, ${.3*r}px)`,backgroundColor:e.backColor}},e.id))}),d.jsx("div",{className:g.deckContainer,children:l.map((e,r)=>d.jsx("div",{className:g.deckCardFront,style:{zIndex:r+1,transform:`translate(${.3*r}px, ${.3*r}px)`},children:d.jsx(h,{card:e})},e.id))}),d.jsx("div",{className:`${g.deckContainer} ${g.discardPileWrapper}`,children:c.length>0&&(()=>{const e=c[c.length-1];return d.jsxs("div",{className:`${g.deckCardFront} ${g.discardTopCard}`,style:{pointerEvents:"auto"},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[d.jsx(h,{card:e}),e.description&&d.jsx("span",{className:g.tooltip,style:{visibility:u?"visible":"hidden",opacity:u?1:0,zIndex:9999},children:e.description})]},e.id)})()})]})]})},exports.Dice=function({sides:r=6,socket:t=null,diceId:n,onRoll:o}){const[a,i]=e.useState(null),[l,s]=e.useState(!1),c=e.useRef(null);return e.useEffect(()=>{if(!t)return;const e=e=>{s(!0);let t=0;c.current=setInterval(()=>{const n=Math.floor(Math.random()*r)+1;i(n),t++,t>=20&&(clearInterval(c.current),c.current=null,i(e),s(!1),o?.(e))},50)};return t.on(`dice:rolled:${n}`,e),()=>{t.off(`dice:rolled:${n}`,e),c.current&&clearInterval(c.current)}},[t,r,n,o]),d.jsx("div",{style:{width:"80px",height:"80px",border:"2px solid #333",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",cursor:l?"not-allowed":"pointer",userSelect:"none",backgroundColor:"#fff",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",transition:"transform 0.2s"},onClick:()=>{t&&!l&&t.emit("dice:roll",{diceId:n,sides:r})},children:a??"🎲"})},exports.PlayField=function({socket:e,deckId:r,name:n,is_logging:o=!1}){const[a,i]=t.useState([]);return t.useEffect(()=>{const t=e=>{const t=e.playFieldCards||[];o&&(x("playField",`[${r}] 場の状態を更新`),x("playField",`[${r}] 古いカード数: ${a.length}, 新しいカード数: ${t.length}`),x("playField",`[${r}] 受信したカードリスト:`,t.map(e=>e.name))),i(e.playFieldCards||[])};return e.on(`deck:update:${r}`,t),()=>{e.off(`deck:update:${r}`,t)}},[e,r]),d.jsxs("section",{style:{border:"2px dashed #ccc",borderRadius:"10px",padding:"12px",background:"#fafafa"},children:[d.jsxs("h3",{style:{marginBottom:"8px"},children:["プレイエリア",n&&d.jsxs("span",{style:{marginLeft:"10px",fontWeight:"normal",fontSize:"0.9em",color:"#666"},children:["（",n,"）"]})]}),d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",minHeight:"120px"},children:[0===a.length&&d.jsx("div",{style:{opacity:.6},children:"（まだカードが出ていません）"}),a.map(r=>d.jsxs("div",{className:g.card,style:{cursor:"pointer",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClick:()=>(r=>{r.ownerId?(e.emit("card:return-to-hand",{deckId:r.deckId,cardId:r.id,targetPlayerId:r.ownerId}),x("playField",`カード ${r.name} を持ち主 ${r.ownerId} の手札に戻すようリクエスト`)):x("playField",`警告: ${r.name} には所有者IDが設定されていません。手札に戻せません。`)})(r),children:[d.jsx(b,{card:r,isFaceUp:!0}),r.description&&d.jsx("span",{className:g.tooltip,children:r.description})]},r.id))]})]})},exports.ScoreBoard=function({socket:e,players:r,currentPlayerId:n,myPlayerId:o,backColor:a="#000000ff"}){const i=t.useMemo(()=>(r||[]).map(e=>({...e,score:e.score??0,cards:e.cards??[],resources:e.resources??[],tokens:e.tokens??[]})),[r]),[l,s]=t.useState([]),c=t.useCallback((e,r)=>{r&&s(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},[]),p=t.useCallback(()=>{if(0===l.length||!o)return;const r=i.find(e=>e.id===o);if(!r)return;const t={};let n;l.forEach(e=>{const o=r.cards.find(r=>r.id===e);o&&(n||(n=o.playLocation),t[o.deckId]||(t[o.deckId]=[]),t[o.deckId].push(o.id))}),n&&(Object.entries(t).forEach(([r,t])=>{e.emit("card:play",{deckId:r,cardIds:t,playerId:o,playLocation:n})}),s([]))},[l,o,i,e]),u=t.useCallback(()=>e.emit("game:next-turn"),[e]);return d.jsxs("div",{style:{padding:"16px",border:"1px solid #333",borderRadius:"12px",backgroundColor:"#f9f9f9",maxWidth:"900px",margin:"0 auto",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[d.jsx("h2",{style:{fontSize:"1.5em",marginBottom:"12px",borderBottom:"2px solid #ddd",paddingBottom:"8px"},children:"ゲームスコアボード"}),d.jsx("ul",{style:{listStyle:"none",padding:0},children:i.map(r=>d.jsx(j,{player:r,currentPlayerId:n,myPlayerId:o,selectedCards:l,toggleCardSelection:c,socket:e},r.id))}),d.jsxs("div",{style:{marginTop:"12px",display:"flex",gap:"6px"},children:[d.jsx("button",{onClick:p,disabled:0===l.length,children:"選択カードを出す"}),d.jsx("button",{onClick:u,children:"次のターン"})]})]})},exports.Timer=function({socket:r=null,onFinish:t}){const[n,o]=e.useState(null);return e.useEffect(()=>{if(!r)return;const e=e=>{o(e)},n=e=>{o(e),e<=0&&t?.()};return r.on("timer:start",e),r.on("timer:update",n),()=>{r.off("timer:start",e),r.off("timer:update",n)}},[r,t]),d.jsxs("div",{style:{width:"300px",height:"80px",border:"2px solid #333",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f9f9f9",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontFamily:"sans-serif"},children:[d.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:null!==n?n<=6?"red":n<=15?"orange":"green":"gray",transition:"color 0.5s ease"},children:["残り時間: ",n??"-","s"]}),d.jsx("div",{style:{marginTop:"6px"},children:d.jsx("button",{onClick:()=>{r&&r.emit("timer:start",30)},style:{marginRight:"4px"},children:"開始"})})]})},exports.TokenStore=function({socket:r,tokenStoreId:t,name:n,onSelect:o}){const[a,i]=e.useState([]),[l,s]=e.useState(null),c=e.useCallback(e=>{console.log(`TokenStore (${t}): 初期情報を受信しました。`,e),i(e&&e.length>0?e:[])},[t]),p=e.useCallback(e=>{console.log(`TokenStore (${t}): 更新情報を受信しました。`,e),i(e||[])},[t]);e.useEffect(()=>{if(!r)return void console.warn("TokenStore: Socket connection is not available. UI remains empty.");const e=`token-store:init:${t}`,n=`token-store:update:${t}`;return r.on(e,c),r.on(n,p),console.log(`TokenStore (${t}): リスナーを登録しました。`),()=>{r.off(e,c),r.off(n,p),console.log(`TokenStore (${t}): リスナーを解除しました。`)}},[r,t,c,p]);const u=e.useMemo(()=>e=>a.find(r=>r.id===e),[a]),f="40px";return d.jsxs("section",{style:{backgroundColor:"#dededeff",padding:"10px",margin:"15px",borderRadius:"10px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)"},children:[d.jsx("h3",{style:{marginBottom:"10px",color:"#333"},children:n}),d.jsx("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:a.map(e=>d.jsx("div",{onClick:()=>(e=>{const r=u(e);r&&(s(e),o?.(r))})(e.id),onDoubleClick:()=>(e=>{const n=u(e);if(!n)return;const o="game:acquire-token",a={tokenStoreId:t,tokenId:e,tokenName:n.name};console.log(`[TokenStore] ダブルクリック: トークン獲得イベント '${o}' を送信`,a),r.emit(o,a),s(null)})(e.id),style:{padding:"8px",width:f,height:f,borderRadius:"50%",border:l===e.id?"2px solid #f6fbd1ff":"2px solid #ccc",backgroundColor:"#4f4848ff",cursor:"pointer",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},children:d.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:d.jsx(C,{token:e})})},e.id))})]})};
